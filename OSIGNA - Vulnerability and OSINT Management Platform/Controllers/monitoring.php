<?php

class Monitoring extends Auth_Controller {

	function index()
	{
	echo "MONITORING";
	}
	
	function alerts()
	{
		echo "ALERTS";
		$data['main_content'] = 'mon_alerts_form';
		$this->load->view('includes/template-beta', $data);
	}
	
	function availability()
	{
		echo "AVAILABILITY";
		$data['main_content'] = 'mon_availability_form';
		$this->load->view('includes/template-beta', $data);
	}
	
	function versions()
	{
		echo "VERSIONS";
		$data['main_content'] = 'mon_versions_form';
		$this->load->view('includes/template-beta', $data);
	}
	
	function secheck()
	{
		// Load sites
		$this->load->library('api');
		$sitesList = $this->api->getWebsites();
		
		// Load view
		$data['main_content'] = 'mon_sec_form';
		$opt = array($sitesList);
		$data['opt'] = $opt;
		$opt_load = array(
			'<script type="text/javascript" src="http://deadislandcraft.com/circles/js/lib/jquery-1.6.4.min.js"></script>',
			'<script type="text/javascript" src="http://deadislandcraft.com/circles/js/lib/jquery-ui-1.8.16.custom.min.js"></script>',
			'<link rel="stylesheet" type="text/css" href="http://deadislandcraft.com/avgrund.css" />',
			);
		$opt_head = array(
			"title" => "Monitoring",
			"opt_load" => $opt_load,
			);
		$data['opt_head'] = $opt_head;
		
		$this->load->view('includes/template-beta', $data);
	}
	
	/* ALERTS */
	function send_alert() // PHP mail function. We can use Codeigniter's one too with lots of options..
	{
		$mail_body = $this->input->post('body'); // check input + check it's not spam
		$to = "m.impini@gmail.com";
		$subject = "Monitoring Alert";
		$body = $mail_body;
		if (mail($to, $subject, $body)) {
			echo("<p>Message successfully sent!</p>");
		} else {
			echo("<p>Message delivery failed...</p>");
		}
		echo anchor('monitoring/alerts', 'Return', 'title="Alerts"');
	}
}