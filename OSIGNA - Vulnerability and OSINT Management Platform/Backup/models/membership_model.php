<?php

class Membership_model extends CI_Model {

	function validate()
	{
		echo "VALIDATE LOGIN";
			$this->db->where('username', $this->input->post('username'));
			$this->db->where('password', md5($this->input->post('password')));
			$query = $this->db->get('membership');
			echo "FOOOOO";

			if ($query->num_rows == 1)
			{
				// Login ok
				return true;
			}
	}

	function create_member()
	{
		$new_member_insert_data = array(
				'prenom' => $this->input->post('first_name'),
				'nom' => $this->input->post('last_name'),
				'email_address' => $this->input->post('email_address'),
				'username' => $this->input->post('username'),
				'password' => md5($this->input->post('password')),
			);

		$insert = $this->db->insert('membership', $new_member_insert_data);
		return $insert;
	}
	
	function get_websites($userid)
	{	
		$query = $this->db->query("SELECT websites FROM membership WHERE id='".$userid."'");
		return $query->row()->websites;
	}
	
	function get_websites_id($userid)
	{	
		$query = $this->db->query("SELECT list_id_sites FROM membership WHERE id='".$userid."'");
		return $query->row()->list_id_sites;
	}
	
	function update_websites($user, $website) // TODO : based on username which is full of fail..
	{	
		$prev_sites = $this->db->query("SELECT websites FROM membership WHERE username='".$user."'")->row()->websites;
		$new_sites = $prev_sites . ";" . $website;
		$data = array('websites' => $new_sites);
		$where = "username = '" . $user . "'"; 
		$str = $this->db->update('membership', $data, $where);
		return $str;
	}
	
	function get_secureToken($user)
	{
		$query = $this->db->query("SELECT secureToken FROM membership WHERE username='".$user."'");
		return $query->row()->secureToken;
	}
	
	function getIdByUsername($username)
	{
		$query = $this->db->query("SELECT id FROM membership WHERE username='".$username."'");
		return $query->row()->id;
	}
	

}