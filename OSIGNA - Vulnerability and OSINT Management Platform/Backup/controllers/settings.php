<?php

class Settings extends Auth_Controller {

	public $fullsites = array();
	
	public function __construct()
	{
		parent::__construct();
		$this->load->library('api');
		$sitesIds = $this->api->getWebsiteIdsByUseridA($this->session->userdata('id'));
		foreach ($sitesIds as $siteId)
		{
			//echo $siteId['id'];
			$this->fullsites[$siteId['id']] = trim($this->api->getUrlById($siteId['id']));
		}
	}

	function index()
	{
		$this->general();
	}
	
	function general($s = NULL)
	{
		$this->load_page('settings_form', 0);
	}
	
	function sites($s = NULL)
	{
		$this->load_page('settings_site_form', 1, $s);
	}
	
	function scans($s = NULL)
	{
		$this->load_page('settings_scan_form', 2);
	}
	
	function reports($s = NULL)
	{
		$this->load_page('settings_report_form', 3);
	}
	
	function account($s = NULL)
	{
		$this->load_page('settings_account_form', 4);
	}
	
	function load_page($f, $p, $s=NULL)
	{
		$opt = array($this->fullsites, $s);
		$data['opt'] = $opt;
		$data['main_content'] = $f;
		$opt_load = array(
			'<link rel="stylesheet" type="text/css" href="http://www.datalabsecurity.com/webscan/resources/css/jquery-ui-1.8.2.custom.css" />',
			'<script type="text/javascript" src="http://www.datalabsecurity.com/webscan/resources/js/jquery-1.6.4.min.js"></script>',
			'<script type="text/javascript" src="http://www.datalabsecurity.com/webscan/resources/js/jquery-ui-1.8.16.custom.min.js"></script>',
			'<script src="http://www.datalabsecurity.com/webscan/resources/js/jquery.easytabs.min.js" type="text/javascript"></script>',
		);
		$subitems = array('General' => 'settings/general', 'Websites' => 'settings/sites', 'Scans' => 'settings/scans', 'Reports' => 'settings/reports', 'Account' => 'settings/account');
		$title = "Settings";
		$opt_head = array(
			"opt_load" => $opt_load,
			"title" => $title,
			"subitems" => $subitems,
			"defaultTab" => $p,
		);
		$data['opt_head'] = $opt_head;
		$this->load->view('includes/template-beta', $data);
	}
}