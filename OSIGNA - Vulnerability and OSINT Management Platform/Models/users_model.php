<?php

class users_model extends CI_Model {

	function validate()
	{
		//echo "VALIDATE LOGIN";
			$this->db->where('username', $this->input->post('username'));
			$this->db->where('password', md5($this->input->post('password')));
			$query = $this->db->get('users');

			if ($query->num_rows == 1)
			{
				// Login ok
				return true;
			}
			return false;
	}
	
	function getIdByUsername($u)
	{
		//$this->db->where('username', $u);
		$query = $this->db->query("SELECT id FROM users where username='".$u."'")->row()->id;
		//print_r($query);
		return $query;
	}

	function create_member()
	{
		$tdate = getdate();
		$now = $tdate['mon']."-".$tdate['mday']."-".$tdate['year']; // MM-DD-YYYY
		$new_member_insert_data = array(
				'signup_date' => $now,
				'email' => $this->input->post('email_address'),
				'username' => $this->input->post('username'),
				'password' => md5($this->input->post('password')),
				'securetoken' => sha1($this->input->post('email_address').$this->input->post('username').$now),
			);
		$insert = $this->db->insert('users', $new_member_insert_data);
		return $insert;
	}
	
	function getToken($userid)
	{
		$query = $this->db->query("SELECT securetoken FROM users WHERE id='".$userid."'");
		return $query->row()->securetoken;
	}
	

	
	// DEPRECATED 
	function update_websites($user, $website)
	{	
		echo "DEPRECATED FUNCTION : update_websites in membership_model.php\r\n";
		$prev_sites = $this->db->query("SELECT websites FROM users WHERE username='".$user."'")->row()->websites;
		$new_sites = $prev_sites . ";" . $website;
		$data = array('websites' => $new_sites);
		$where = "username = '" . $user . "'"; 
		$str = $this->db->update('users', $data, $where);
		return $str;
	}
	

}