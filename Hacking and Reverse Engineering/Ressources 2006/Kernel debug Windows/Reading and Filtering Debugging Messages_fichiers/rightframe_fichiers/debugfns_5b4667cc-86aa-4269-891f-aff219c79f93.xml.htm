<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0127)http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml.asp?frame=true -->
<!--TOOLBAR_EXEMPT--><HTML xmlns:tool = 
"http://www.microsoft.com/tooltip"><HEAD><TITLE>Reading and Filtering Debugging Messages</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META 
content="DevTest_g, DriverDevTools, Design Guide, Reading and Filtering Debugging Messages" 
name=Description>
<META content="" name=Robots>
<META content="" name=Keywords>
<META content=en-us name=MS.LOCALE><LINK 
href="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/ie4.css" 
type=text/css rel=stylesheet><LINK 
href="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/ie5.css" 
type=text/css rel=stylesheet>
<STYLE>BODY {
	MARGIN: 0px; FONT-FAMILY: verdana,arial,helvetica
}
</STYLE>

<SCRIPT language=javascript 
src="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/langref.js"></SCRIPT>

<SCRIPT language=javascript 
src="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/linkcss.js"></SCRIPT>

<SCRIPT language=javascript 
src="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/toolbar.js"></SCRIPT>

<SCRIPT language=javascript 
src="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/Broker.js"></SCRIPT>
<LINK 
href="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/backsdk4.css" 
type=text/css rel=stylesheet><LINK 
href="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/default.css" 
type=text/css rel=stylesheet>
<SCRIPT language=JavaScript><!--
   function BrowserData()
{
		this.userAgent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)";

		this.bot = false;

		this.browser = "MSIE";

		this.majorVer = 6;

		this.minorVer = "0";

		this.betaVer = "0";

		this.platform = "NT";

		this.platVer = "5.1; SV1";

		this.getsNavBar = true;

		this.doesActiveX = true;

		this.doesPersistence = true;

		this.fullVer = 6;

   }

   var oBD = new BrowserData();

   //--></SCRIPT>

<SCRIPT>
	if( self == top )
{
	location = "/library/en-us/DevTest_g/hh/DevTest_g/debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml.asp";
}

</SCRIPT>
<xml id=xmlPageContext><eyebrow findmenu="false">
	<item label="MSDN Home" url="/default.asp"/>
	<item label="MSDN Library" url="/library/default.asp"/>
	<item label="Win32 and COM Development" url="/library/en-us/dnanchor/html/anch_win32com.asp" id="msdnlib1382" xmlsrc="/library/en-us/toc/msdnlib/msdnlib1382_.xml"/><item label="Windows Driver Kit" id="msdnlib1547" xmlsrc="/library/en-us/toc/msdnlib/msdnlib1547_.xml"/><item label="Driver Development Tools" url="/library/en-us/DevTest_g/hh/DevTest_g/Z_ddtools_HDR_8a4e605a-bb49-4478-8236-b868d3366c12.xml.asp" id="DevTest_g2" xmlsrc="/library/en-us/toc/DevTest_g/DevTest_g2_.xml"/><item label="Tools for Debugging Drivers" url="/library/en-us/DevTest_g/hh/DevTest_g/TOC_Debugging_b61a3911-d5dc-42de-96af-deb0d7df233b.xml.asp" id="DevTest_g1332" xmlsrc="/library/en-us/toc/DevTest_g/DevTest_g1332_.xml"/><item label="Using Debugging Code in a Driver" url="/library/en-us/DevTest_g/hh/DevTest_g/DebugFns_697a0875-bd9a-43a4-8223-c754952e80fe.xml.asp" id="DevTest_g1333"/><item label="Debugging Code Overview" url="/library/en-us/DevTest_g/hh/DevTest_g/DebugFns_aad78321-5dcc-438a-9da3-11796c150db1.xml.asp" id="DevTest_g1334"/><item label="Reading and Filtering Debugging Messages" url="/library/en-us/DevTest_g/hh/DevTest_g/DebugFns_5b4667cc-86aa-4269-891f-aff219c79f93.xml.asp" id="DevTest_g1338"/></eyebrow></xml><!--VENUS_START-->
<META content=DebugFns_5b4667cc-86aa-4269-891f-aff219c79f93.xml 
name=MSHKeywordA>
<META content="debugging code [WDK], reading messages" name=MSHKeywordK>
<META content="debugging code [WDK], filtering messages" name=MSHKeywordK>
<META content="reading debugging messages" name=MSHKeywordK>
<META content="filtering debugging messages [WDK]" name=MSHKeywordK>
<META content="routines [WDK debugging], message filtering" name=MSHKeywordK>
<META content="filter masks [WDK debugging]" name=MSHKeywordK>
<META content="component names [WDK debugging]" name=MSHKeywordK>
<META content="importance bit field [WDK debugging]" name=MSHKeywordK>
<META content="levels [WDK debugging]" name=MSHKeywordK>
<META content="Level parameter" name=MSHKeywordK>
<META content="displaying debugging messages" name=MSHKeywordK>
<META content="prioritizing debugging messages [WDK]" name=MSHKeywordK>
<META content="DbgPrint buffer" name=MSHKeywordK><!---VENUS_END---><LINK 
href="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/css.css" 
type=text/css rel=stylesheet>
<SCRIPT language=javascript>
var doImage=doImage;var TType=TType;
function mhHover(tbl,idx,cls){var t,d;if(document.getElementById)t=document.getElementById(tbl);else t=document.all(tbl);if(t==null)return;if(t.getElementsByTagName)d=t.getElementsByTagName("TD");else d=t.all.tags("TD");if(d==null)return;if(d.length<=idx)return;d[idx].className=cls;}
function footerjs(doc){if(doImage==null){var tt=TType==null?"PV":TType;doc.write('<layer visibility="hide"><div style="display:none"><img src="http://c.microsoft.com/trans_pixel.asp?source=msdn&TYPE=' + tt + '&p=library_en-us_DevTest_g_hh_DevTest_g_debugfns&URI=%2flibrary%2ftoolbar%2f3.0%2fasp.aspx%3fmode%3dhead%26c%3d%2fnonlibraryshell.config%26h%3dmsdn%252Emicrosoft%252Ecom%26u%3d%252Flibrary%252Fen%252Dus%252FDevTest%255Fg%252Fhh%252FDevTest%255Fg%252Fdebugfns%255F5b4667cc%252D86aa%252D4269%252D891f%252Daff219c79f93%252Exml%252Easp%26r%3dhttp%253A%252F%252Fmsdn%252Emicrosoft%252Ecom%252Flibrary%252Fshared%252Fdeeptree%252Fasp%252Frightframe%252Easp%253Fdtcfg%253D%252Flibrary%252Fdeeptreeconfig%252Exml%2526url%253D%252Flibrary%252Fen%252Dus%252FDevTest%255Fg%252Fhh%252FDevTest%255Fg%252Fdebugfns%255F5b4667cc%252D86aa%252D4269%252D891f%252Daff219c79f93%252Exml%252Easp%253Fframe%253Dtrue%2526hidetoc%253Dfalse&GUID=1F4FC18C-F71E-47FB-8FC9-612F8EE59C61&r=http%3a%2f%2fmsdn.microsoft.com%2flibrary%2fshared%2fdeeptree%2fasp%2frightframe.asp%3fdtcfg%3d%2flibrary%2fdeeptreeconfig.xml%26url%3d%2flibrary%2fen-us%2fDevTest_g%2fhh%2fDevTest_g%2fdebugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml.asp%3fframe%3dtrue%26hidetoc%3dfalse" width=0 height=0 hspace=0 vspace=0 border=0 /></div></layer>');}}
</SCRIPT>

<META content="MSHTML 6.00.2900.2995" name=GENERATOR></HEAD>
<BODY text=#000000 bgColor=#ffffff leftMargin=0 topMargin=0 MARGINWIDTH="0" 
MARGINHEIGHT="0">
<TABLE height=24 cellSpacing=0 cellPadding=4 width="100%" bgColor=#ffffff 
border=0>
  <TBODY>
  <TR>
    <TD class=eyebrow vAlign=center align=left width="100%">&nbsp;&nbsp; <A 
      class=small href="http://msdn.microsoft.com/default.asp" target=_top>MSDN 
      Home</A>&nbsp;&gt;&nbsp; <A class=small 
      href="http://msdn.microsoft.com/library/default.asp" target=_top>MSDN 
      Library</A>&nbsp;&gt;&nbsp; <A class=small 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnanchor/html/anch_win32com.asp" 
      target=_top>Win32 and COM Development</A>&nbsp;&gt;&nbsp; <A class=small 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/DevTest_g/hh/DevTest_g/Z_ddtools_HDR_8a4e605a-bb49-4478-8236-b868d3366c12.xml.asp" 
      target=_top>Driver Development Tools</A>&nbsp;&gt;&nbsp; <A class=small 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/DevTest_g/hh/DevTest_g/TOC_Debugging_b61a3911-d5dc-42de-96af-deb0d7df233b.xml.asp" 
      target=_top>Tools for Debugging Drivers</A>&nbsp;&gt;&nbsp; <A class=small 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/DevTest_g/hh/DevTest_g/DebugFns_697a0875-bd9a-43a4-8223-c754952e80fe.xml.asp" 
      target=_top>Using Debugging Code in a Driver</A>&nbsp;&gt;&nbsp; <A 
      class=small 
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/DevTest_g/hh/DevTest_g/DebugFns_aad78321-5dcc-438a-9da3-11796c150db1.xml.asp" 
      target=_top>Debugging Code Overview</A><A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/"></A> 
    </TD></TR></TBODY></TABLE>
<TABLE class=clsContainer style="TABLE-LAYOUT: fixed" cellSpacing=0 
cellPadding=15 width="100%" border=0 float="left">
  <TBODY>
  <TR>
    <TD vAlign=top><!--TOOLBAR_START--><!--TOOLBAR_EXEMPT--><!--TOOLBAR_END--><!-- Begin Content -->
      <DIV style="DISPLAY: none"></DIV>
      <TABLE class=buttonbarshade cellSpacing=0 border=0>
        <TBODY>
        <TR>
          <TD noWrap>&nbsp;</TD></TR></TBODY></TABLE>
      <TABLE class=buttonbartable cellSpacing=0>
        <TBODY>
        <TR id=hdr>
          <TD class=runninghead noWrap>Windows Driver Kit: Driver Development 
            Tools</TD></TR></TBODY></TABLE>
      <H1><A name=DebugFns_5b4667cc-86aa-4269-891f-aff219c79f93.xml></A>Reading 
      and Filtering Debugging Messages</H1>
      <P>The <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_0c93bbeb-9eb9-4c73-944f-565401dbb073.xml.asp"><B>DbgPrintEx</B></A>, 
      <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_e3774486-d60a-4853-8d86-5ffb99ef4bcb.xml.asp"><B>vDbgPrintEx</B></A>, 
      and <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_375418aa-5241-4b2c-9369-c930c3ca1ca6.xml.asp"><B>KdPrintEx</B></A> 
      routines send a message to the kernel debugger under certain conditions. 
      This allows you to filter out low-priority messages.</P>
      <P></P>
      <P class=note><B>Note</B>&nbsp;&nbsp;In Microsoft Windows Server&nbsp;2003 
      and earlier versions of Windows, the <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_5e11bbcc-adc2-46c0-b371-0e54c50bb2dc.xml.asp"><B>DbgPrint</B></A> 
      and <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/debugfns_630aea64-3f51-4c73-8575-00a507846ab9.xml.asp"><B>KdPrint</B></A> 
      routines send messages to the kernel debugger unconditionally. In 
      Windows&nbsp;Vista and later versions of Windows, these routines send 
      messages conditionally, like <B>DbgPrintEx</B> and <B>KdPrintEx</B>. 
      Whichever version of Windows you are using, it is recommended that you use 
      <B>DbgPrintEx</B> and <B>KdPrintEx</B>, since these allow you to control 
      the conditions under which the message will be sent.</P><B>To filter 
      debugging messages</B>
      <OL type=1>
        <LI>For each message you wish to send to the debugger, use 
        <B>DbgPrintEx</B>, <B>vDbgPrintEx</B>, or <B>KdPrintEx</B> in your 
        driver's code. Pass the appropriate component name to the 
        <I>ComponentId</I> parameter, and pass a value to the <I>Level</I> 
        parameter that reflects the severity or nature of this message. The 
        message itself is passed to the <I>Format</I> and <I>arguments</I> 
        parameters using the same syntax as <B>printf</B>. 
        <LI>Set the value of the appropriate <I>component filter mask</I>. Each 
        component has a different mask; the mask value indicates which of that 
        component's messages will be displayed. The component filter mask may be 
        set in the registry using a registry editor, or in memory using a kernel 
        debugger. 
        <LI>Attach a kernel debugger to the computer. Each time your driver 
        passes a message to <B>DbgPrintEx</B>, <B>vDbgPrintEx</B>, or 
        <B>KdPrintEx</B>, the values passed to <I>ComponentId</I> and 
        <I>Level</I> will be compared with the value of the corresponding 
        component filter mask. If these values satisfy certain criteria, the 
        message will be sent to the kernel debugger and displayed. Otherwise, no 
        message will be sent. </LI></OL>
      <P></P>
      <P>Full details follow.</P>
      <P class=note><B>Note</B>&nbsp;&nbsp;All references on this page to 
      <B>DbgPrintEx</B> apply equally to <B>KdPrintEx</B> and 
      <B>vDbgPrintEx</B>.</P>
      <H4>Identifying the Component Name</H4>
      <P>Each component has a separate filter mask. This allows the debugger to 
      configure the filter for each component separately.</P>
      <P>Each component is referred to in different ways, depending on the 
      context. In the <I>ComponentId</I> parameter of <B>DbgPrintEx</B>, the 
      component name is prefixed with "DPFLTR_" and suffixed with "_ID". In the 
      registry, the component filter mask has the same name as the component 
      itself. In the debugger, the component filter mask is prefixed with "Kd_" 
      and suffixed with "_Mask".</P>
      <P>There is a complete list of component names (in DPFLTR_<I>XXXX</I>_ID 
      format) in the <I>Dpfilter.h </I>Windows Driver Kit (WDK) header file . 
      Most of these component names are reserved for Windows and for drivers 
      written by Microsoft.</P>
      <P>There are six component names reserved for independent hardware 
      vendors. To avoid mixing your driver's output with the output of Windows 
      components, you should use one of the following component 
names:</P><B></B>
      <TABLE>
        <TBODY>
        <TR vAlign=top>
          <TH>Component name</TH>
          <TH>Driver type</TH></TR>
        <TR vAlign=top>
          <TD>IHVVIDEO</TD>
          <TD>Video driver</TD></TR>
        <TR vAlign=top>
          <TD>IHVAUDIO</TD>
          <TD>Audio driver</TD></TR>
        <TR vAlign=top>
          <TD>IHVNETWORK</TD>
          <TD>Network driver</TD></TR>
        <TR vAlign=top>
          <TD>IHVSTREAMING</TD>
          <TD>Kernel streaming driver</TD></TR>
        <TR vAlign=top>
          <TD>IHVBUS</TD>
          <TD>Bus driver</TD></TR>
        <TR vAlign=top>
          <TD>IHVDRIVER</TD>
          <TD>Any other type of driver</TD></TR></TBODY></TABLE>
      <P></P>
      <P>For example, if you are writing a video driver, you would use 
      DPFLTR_IHVVIDEO_ID as the <I>ComponentId</I> parameter of 
      <B>DbgPrintEx</B>, use the value name IHVVIDEO in the registry, and refer 
      to <B>Kd_IHVVIDEO_Mask</B> in the debugger.</P>
      <P>In Windows&nbsp;Vista and later versions of Windows, all messages sent 
      by <B>DbgPrint</B> and <B>KdPrint</B> are associated with the DEFAULT 
      component.</P>
      <H4>Choosing the Correct Level</H4>
      <P>The <I>Level</I> parameter of the <B>DbgPrintEx</B> routine is of type 
      DWORD. It is used to determine the <I>importance bit field</I>. The 
      connection between the <I>Level</I> parameter and this bit field depends 
      on the size of <I>Level</I>:</P><B></B>
      <UL type=disc>
        <LI>If <I>Level</I> is equal to a number between 0 and 31, inclusive, it 
        is interpreted as a bit shift. The importance bit field is set to the 
        value 1&nbsp;&lt;&lt;&nbsp;<I>Level</I>. Thus, choosing a value between 
        0 and 31 for <I>Level</I> results in a bit field with exactly one bit 
        set. If <I>Level</I> is 0, the bit field is equivalent to 0x00000001; if 
        <I>Level</I> is 31, the bit field is equivalent to 0x80000000. 
        <LI>If <I>Level</I> is a number between 32 and 0xFFFFFFFF inclusive, the 
        importance bit field is set to the value of <I>Level</I> itself. 
</LI></UL>
      <P></P>
      <P>Thus, if you wish to set the bit field to 0x00004000, you can specify 
      <I>Level</I> as 0x00004000 or simply as 14. As a consequence of this 
      system, some bit field values cannot be produced — including a bit field 
      which is entirely zero.</P>
      <P>The following constants can be useful for setting the value of 
      <I>Level</I>. They are defined in the <I>Dpfilter.h </I>WDK header 
      file:</P>
      <P 
      style="PADDING-RIGHT: 4pt; PADDING-LEFT: 4pt; PADDING-BOTTOM: 2pt; FONT: 100% Courier New, Courier, mono; CURSOR: text; COLOR: #660000; PADDING-TOP: 2pt"><NOBR>#define&nbsp;&nbsp;&nbsp;DPFLTR_ERROR_LEVEL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<BR>#define&nbsp;&nbsp;&nbsp;DPFLTR_WARNING_LEVEL&nbsp;&nbsp;&nbsp;1<BR>#define&nbsp;&nbsp;&nbsp;DPFLTR_TRACE_LEVEL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<BR>#define&nbsp;&nbsp;&nbsp;DPFLTR_INFO_LEVEL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<BR>#define&nbsp;&nbsp;&nbsp;DPFLTR_MASK&nbsp;&nbsp;&nbsp;&nbsp;0x8000000<BR><BR></NOBR></P>
      <P>One easy way to use the <I>Level</I> parameter is to always use values 
      between 0 and 31 — using the bits 0, 1, 2, and 3 with the meaning given by 
      DPFLTR_<I>XXXX</I>_LEVEL, and using the other bits to mean whatever you 
      choose.</P>
      <P>Another easy way to use the <I>Level</I> parameter is to always use 
      explicit bit fields. If you choose this method, you may wish to OR the 
      value DPFLTR_MASK with your bit field; this ensures that you will not 
      accidentally use a value less than 32.</P>
      <P>To make your driver compatible with the way Windows uses message 
      levels, you should only set the lowest bit (0x1) of the importance bit 
      field if a serious error occurs. If you are using <I>Level</I> values less 
      than 32, this corresponds to DPFLTR_ERROR_LEVEL. If this bit is set, your 
      message is going to be viewed any time someone attaches a kernel debugger 
      to a computer on which your driver is running. </P>
      <P>The warning, trace, and information levels should be used in the 
      appropriate situations. Other bits can be freely used for any purposes 
      that you find useful. This allows you to have a wide variety of message 
      types that can be selectively seen or hidden.</P>
      <P>In Windows&nbsp;Vista and later versions of Windows, all messages sent 
      by <B>DbgPrint</B> and <B>KdPrint</B> behave like <B>DbgPrintEx</B> and 
      <B>KdPrintEx</B> messages with <I>Level</I> equal to DPFLTR_INFO_LEVEL. In 
      other words, these messages have the third bit of their importance bit 
      field set.</P>
      <H4>Setting the Component Filter Mask</H4>
      <P>There are two ways to set a component filter mask:</P><B></B>
      <UL type=disc>
        <LI>The component filter mask can be accessed in the registry key 
        <B>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session&nbsp;Manager\Debug&nbsp;Print&nbsp;Filter</B>. 
        Using a registry editor, create or open this key. Under this key, create 
        a value with the name of the desired component, in uppercase. Set it 
        equal to the DWORD value that you wish to use as the component filter 
        mask. 
        <LI>If a kernel debugger is active, it can access the component filter 
        mask value by dereferencing the address stored in the symbol 
        <B>Kd_</B><I><B>XXXX</B></I><B>_Mask</B>, where <I>XXXX</I> is the 
        desired component name. You can display the value of this mask in WinDbg 
        or KD with the <B>dd&nbsp;(Display DWORD)</B> command, or enter a new 
        component filter mask with the <B>ed&nbsp;(Enter DWORD)</B> command. If 
        there is a danger of symbol ambiguity, you may wish to specify this 
        symbol as <B>nt!Kd_</B><I><B>XXXX</B></I><B>_Mask</B>. </LI></UL>
      <P></P>
      <P>Filter masks stored in the registry take effect during boot. Filter 
      masks created by the debugger take effect immediately, and persist until 
      Windows is restarted. A value set in the registry can be overridden by the 
      debugger, but the component filter mask will return to the value specified 
      in the registry if the system is restarted.</P>
      <P>There is also a system-wide mask called WIN2000. This is equal to 0x1 
      by default, though it can be changed through the registry or the debugger 
      like all other components. When filtering is performed, each component 
      filter mask is first ORed with the WIN2000 mask. In particular, this means 
      that components whose masks have never been specified default to 0x1.</P>
      <H4>Criteria for Displaying the Message</H4>
      <P>When <B>DbgPrintEx</B> is called in kernel-mode code, Windows compares 
      the message importance bit field specified by <I>Level</I> with the filter 
      mask of the component specified by <I>ComponentId</I>.</P>
      <P class=note><B>Note</B>&nbsp;&nbsp;Recall that when the <I>Level</I> 
      parameter is between 0 and 31, the importance bit field is equal to 
      1&nbsp;&lt;&lt;&nbsp;<I>Level</I>, but when the <I>Level</I> parameter is 
      32 or higher, the importance bit field is simply equal to 
<I>Level</I>.</P>
      <P>Windows performs an AND operation on the importance bit field and the 
      component filter mask. If the result is nonzero, the message is sent to 
      the debugger.</P>
      <H4>Example</H4>
      <P>Suppose that before the last boot, you created the following values in 
      the <B>Debug&nbsp;Print&nbsp;Filter</B> key:</P><B></B>
      <UL type=disc>
        <LI>IHVVIDEO, with a value equal to DWORD 0x2. 
        <LI>IHVBUS, equal to DWORD 0x7FF. </LI></UL>
      <P></P>
      <P>Now you issue the following commands in the kernel debugger:</P>
      <P 
      style="PADDING-RIGHT: 4pt; PADDING-LEFT: 4pt; PADDING-BOTTOM: 2pt; FONT: 100% Courier New, Courier, mono; CURSOR: text; COLOR: #660000; PADDING-TOP: 2pt"><NOBR>kd&gt;&nbsp;<B>ed&nbsp;Kd_IHVVIDEO_Mask&nbsp;0x8</B>&nbsp;<BR>kd&gt;&nbsp;<B>ed&nbsp;Kd_IHVAUDIO_Mask&nbsp;0x7</B>&nbsp;<BR><BR></NOBR></P>
      <P>At this point, the IHVVIDEO component has a filter mask of 0x8, the 
      IHVAUDIO component has a filter mask of 0x7, and the IHVBUS component has 
      a filter mask of 0x7FF.</P>
      <P>However, because these masks are automatically ORed with the WIN2000 
      system-wide mask (which is usually equal to 0x1), the IHVVIDEO mask is 
      effectively equal to 0x9. Components whose filter masks have not been set 
      at all (for instance, IHVSTREAMING or DEFAULT) will have a filter mask of 
      0x1.</P>
      <P>Now suppose that the following function calls occur in various 
      drivers:</P>
      <P 
      style="PADDING-RIGHT: 4pt; PADDING-LEFT: 4pt; PADDING-BOTTOM: 2pt; FONT: 100% Courier New, Courier, mono; CURSOR: text; COLOR: #660000; PADDING-TOP: 2pt"><NOBR>DbgPrintEx(&nbsp;DPFLTR_IHVVIDEO_ID,&nbsp;&nbsp;DPFLTR_INFO_LEVEL,&nbsp;&nbsp;&nbsp;"First&nbsp;message.\n");<BR>DbgPrintEx(&nbsp;DPFLTR_IHVAUDIO_ID,&nbsp;&nbsp;7,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Second&nbsp;message.\n");<BR>DbgPrintEx(&nbsp;DPFLTR_IHVBUS_ID,&nbsp;&nbsp;&nbsp;&nbsp;DPFLTR_MASK&nbsp;|&nbsp;0x10,&nbsp;&nbsp;"Third&nbsp;message.\n");<BR>DbgPrint(&nbsp;"Fourth&nbsp;message.\n");<BR><BR></NOBR></P>
      <P>The first message has its <I>Level</I> parameter equal to 
      DPFLTR_INFO_LEVEL, which is 3. Since this is less than 32, it is treated 
      as a bit shift, resulting in an importance bit field of 0x8. This value is 
      then ANDed with the effective IHVVIDEO component filter mask of 0x9, 
      giving a nonzero result. So the first message is transmitted to the 
      debugger.</P>
      <P>The second message has its <I>Level</I> parameter equal to 7. Again, 
      this is treated as a bit shift, resulting in an importance bit field of 
      0x80. This is then ANDed with the IHVAUDIO component filter mask of 0x7, 
      giving a result of zero. So the second message is <I>not</I> 
      transmitted.</P>
      <P>The third message has its <I>Level</I> parameter equal to 
      DPFLTR_MASK&nbsp;|&nbsp;0x10. This is greater than 31, and therefore the 
      importance bit field is set equal to the value of <I>Level</I> — in other 
      words, to 0x80000010. This is then ANDed with the IHVBUS component filter 
      mask of 0x7FF, giving a nonzero result. So the third message is 
      transmitted to the debugger.</P>
      <P>The fourth message was passed to the <B>DbgPrint</B> routine instead of 
      the <B>DbgPrintEx</B> routine. In Windows Server&nbsp;2003 and earlier 
      versions of Windows, messages passed to <B>DbgPrint</B> are always 
      transmitted. In Windows&nbsp;Vista and later versions of Windows, messages 
      passed to <B>DbgPrint</B> are always given a default filter. The 
      importance bit field is equal to 1&nbsp;&lt;&lt;&nbsp;DPFLTR_INFO_LEVEL, 
      which is 0x00000008. The component for this routine is DEFAULT. Since you 
      have not set the DEFAULT component filter mask, it has a value of 0x1. 
      When this is ANDed with the importance bit field, the result is zero. So 
      the fourth message is <I>not</I> transmitted.</P>
      <P></P>
      <H3><A name=59e999b1-42db-414a-962a-5cd19aede5ed></A>The DbgPrint Buffer 
      and the Debugger</H3>
      <P>When the <B>DbgPrint</B>, <B>DbgPrintEx</B>, <B>vDbgPrintEx</B>, 
      <B>KdPrint</B>, or <B>KdPrintEx</B> routine transmits a message to the 
      debugger, the formatted string is sent to the DbgPrint buffer. The 
      contents of this buffer are displayed immediately in the Debugger Command 
      window, unless this display has been disabled by using the <B>Buffer 
      DbgPrint Output</B> option of GFlags.</P>
      <P>If this display has been disabled, the contents of the DbgPrint buffer 
      can only be viewed by using the <B>!dbgprint</B> extension command. For 
      information about debugger extensions, see <A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/dbgblurb_f1cd9633-734a-49e5-8eac-bd37897fd80a.xml.asp">Debugging 
      Tools for NT-Based Operating Systems</A>.</P>
      <P>Any single call to <B>DbgPrint</B>, <B>DbgPrintEx</B>, 
      <B>vDbgPrintEx</B>, <B>KdPrint</B>, or <B>KdPrintEx</B> will only transmit 
      512 bytes of information. Any output longer than this will be lost. The 
      DbgPrint buffer itself can hold up to 4 KB of data on a free build of 
      Windows, and up to 32 KB of data on a checked build of Windows. On Windows 
      Server&nbsp;2003 and later versions of Windows, you can use the KDbgCtrl 
      tool to alter the size of the DbgPrint buffer. This tool is part of 
      Debugging Tools for Windows.</P>
      <P>If a message is filtered out because of its <I>ComponentId</I> and 
      <I>Level</I> values, it is not transmitted across the debugging 
      connection. Therefore, there is no way to display this message in the 
      debugger.</P>
      <P></P>
      <DIV class=footer><BR><A 
      href="http://msdn.microsoft.com/library/en-us/DevTest_g/hh/DevTest_g/DDKLegal.asp">©&nbsp;2006&nbsp;Microsoft 
      Corporation</A><BR>Built on&nbsp;August 25, 2006<BR></DIV>
      <DIV style="VISIBILITY: hidden">Build machine: CAPEBUILD</DIV><!-- End Content --></TD></TR></TBODY></TABLE><BR 
style="OVERFLOW: hidden; LINE-HEIGHT: 1px" clear=all>
<TABLE id=msviFooter cellSpacing=0 cellPadding=0 width="100%">
  <TBODY>
  <TR vAlign=bottom>
    <TD id=msviFooter2 
    style="FILTER: progid:DXImageTransform.Microsoft.Gradient(startColorStr='#FFFFFF', endColorStr='#669AFF', gradientType='1')">
      <DIV id=msviLocalFooter><NOBR><A 
      href="http://go.microsoft.com/?linkid=317027">Manage Your Profile</A> 
      |</NOBR><WBR><NOBR><A 
      href="http://msdn.microsoft.com/isapi/gomscom.asp?target=/legal/" 
      target=_parent>Legal</A> |</NOBR><WBR><NOBR><A 
      href="http://go.microsoft.com/?linkid=2028439" target=_parent>Contact 
      Us</A> |</NOBR><WBR><NOBR><A href="http://msdn.microsoft.com/flash/" 
      target=_parent>MSDN Flash Newsletter</A></NOBR></DIV>
      <DIV id=msviGlobalFooter><SPAN dir=ltr>© 2006 Microsoft Corporation. All 
      rights reserved.&nbsp;</SPAN><NOBR><A 
      href="http://www.microsoft.com/info/cpyright.mspx">Terms of Use</A> 
      |</NOBR><WBR><NOBR><A 
      href="http://msdn.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</A> 
      |</NOBR><WBR><NOBR><A 
      href="http://www.microsoft.com/info/privacy.mspx">Privacy 
      Statement</A></NOBR></DIV></TD>
    <TD width=105 bgColor=#669aff><IMG title="" height=29 alt=Microsoft 
      src="debugfns_5b4667cc-86aa-4269-891f-aff219c79f93.xml_fichiers/text.jpg" 
      width=105 border=0></TD></TR></TBODY></TABLE>
<SCRIPT language=javascript>var msviFooter2;if (document.getElementById){msviFooter2 = document.getElementById("msviFooter2");msviFooter2.style.filter = "";}</SCRIPT>

<TABLE height=58 cellSpacing=0 cellPadding=0 width="100%">
  <TBODY>
  <TR vAlign=top>
    <TD>
      <DIV style="WIDTH: 200px"></DIV></TD>
    <TD 
    style="FILTER: progid:DXImageTransform.Microsoft.Gradient(startColorStr='#FFFFFF', endColorStr='#669AFF', gradientType='1')" 
    width="100%"></TD></TR></TBODY></TABLE>
<SCRIPT language=javascript>footerjs(document);</SCRIPT>
</BODY></HTML>
